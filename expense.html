<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exprense Tracker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <style>
        table,th,td{
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <h1>Expense Tracker</h1>
<div class="container min-vh-100 d-flex justify-content-center align-items-center">
    <form onsubmit="addExpense(event)">
        Choose expense amount: <br> <input type="text" name="amount" id="amount"> <br>
        Choose description: <br> <input type="text" name="description" id="description"> <br>
        Choose a category: <br><select name="category" id="category">
        <option value="Fuel">Fuel</option>
        <option value="Clothing">Clothing</option>
        <option value="Food">Food</option></select> <br> <br>
        <input type="submit" value="Add Expense">
    </form> </div><br>
    <h2>Expense Table</h2>
    <table id="expenseTable" class="table">
    <tr>
        <th>Amount</th>
        <th>Description</th>
        <th>Category</th>
        <th>Functionality</th>
    </tr>
    </table>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.js"></script>
    <script>
       async function addExpense(event){
        try{
            event.preventDefault();
            const obj = {
                amount:event.target.amount.value,
                description:event.target.description.value,
                category:event.target.category.value
            }
            const response = await axios.post('http://localhost:5000/expense/add-expense',obj);
            showExpenseOnScreen(response.data.newExpenseAdded);
        } catch(error){
            console.log(error);
            document.body.innerHTML = document.body.innerHTML + '<h4>Something went wrong!</h4>'
        }
       }
        function showExpenseOnScreen(obj){
            const parentElement = document.getElementById('expenseTable');
            const childElement = `<tr id=${obj.id}><td>${obj.amount}</td><td>${obj.description}</td><td>${obj.category}</td>
                <td><button onclick="editExpense('${obj.id}','${obj.amount}','${obj.description}','${obj.category}')">Edit Expense
                    <button onclick="deleteExpense(${obj.id})">Delete Expense
                </td></tr>`
            parentElement.innerHTML = parentElement.innerHTML + childElement;        
        }

        async function deleteExpense(expenseID){
            try{
                await axios.delete(`http://localhost:5000/expense/delete-expense/${expenseID}`);
                removeExpenseFromScreen(expenseID);
            } catch(error){
                console.log(error);
                document.body.innerHTML = document.body.innerHTML + '<h4>Something went wrong!</h4>'
            }
        }

        function removeExpenseFromScreen(expenseID){
            document.getElementById(expenseID).remove();
        }

        function editExpense(id,amount,description,category){
            document.getElementById('amount').value = amount;
            document.getElementById('description').value = description;
            document.getElementById('category').value = category;
            deleteExpense(id);
        }

        window.addEventListener("DOMContentLoaded",async ()=>{
            try{
                const token = localStorage.getItem('token');
                const response = await axios.get('http://localhost:5000/expense/get-expense',{headers:{"Authorization":token}});
                for(var i=0;i<response.data.allExpenses.length;i++){
                    showExpenseOnScreen(response.data.allExpenses[i]);
                }
            } catch(error){
                console.log(error);
                document.body.innerHTML = document.body.innerHTML + '<h4>Something went wrong!</h4>'
            }
        });
    </script>
</body>
</html>